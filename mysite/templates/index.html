<!DOCTYPE html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MemeLand - –°–≤—ñ—Ç –º–µ–º—ñ–≤ —Ç–∞ –≥—É–º–æ—Ä—É</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="{% url 'index' %}">ü§£ MemeLand</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <div class="navbar-nav me-auto">
            <a class="nav-link active" href="{% url 'index' %}">–ì–æ–ª–æ–≤–Ω–∞</a>
            <a class="nav-link" href="{% url 'blog' %}">–ë–ª–æ–≥</a>
            <a class="nav-link" href="{% url 'news' %}">–ù–æ–≤–∏–Ω–∏</a>
            <a class="nav-link" href="{% url 'about' %}">–ü—Ä–æ –Ω–∞—Å</a>
            <a class="nav-link" href="{% url 'contact' %}">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a>
          </div>
          <div class="navbar-nav">
            {% if user.is_authenticated %}
            <a class="nav-link" href="{% url 'profile' %}"
              >üë§ {{ user.username }}</a
            >
            <a class="nav-link" href="{% url 'logout' %}">–í–∏—Ö—ñ–¥</a>
            {% else %}
            <a class="nav-link" href="{% url 'login' %}">–í—Ö—ñ–¥</a>
            <a class="nav-link" href="{% url 'register' %}">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
            {% endif %}
          </div>
        </div>
      </div>
    </nav>

    <!-- –ì–æ–ª–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container mt-5">
      <div class="row">
        <div class="col-lg-12">
          <!-- Hero —Å–µ–∫—Ü—ñ—è -->
          <div class="jumbotron bg-primary text-white p-5 rounded mb-4">
            <div class="container-fluid py-5">
              <h1 class="display-4">üéâ –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ MemeLand! üéâ</h1>
              <p class="lead">
                –ù–∞–π–∫—Ä–∞—â–∏–π –±–ª–æ–≥ –ø—Ä–æ –º–µ–º–∏, —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–∫—É–ª—å—Ç—É—Ä—É —Ç–∞ —Å–º—ñ—Ö –¥–æ —Å–ª—ñ–∑!
              </p>
              <hr class="my-4" />
              <p class="mb-0">
                –¢—É—Ç –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ –Ω–∞–π—Å–≤—ñ–∂—ñ—à—ñ –º–µ–º–∏, —ó—Ö–Ω—é —ñ—Å—Ç–æ—Ä—ñ—é —Ç–∞ –∫—É–ª—å—Ç—É—Ä–Ω–∏–π
                –≤–ø–ª–∏–≤.
              </p>
              <a
                class="btn btn-light btn-lg mt-3"
                href="{% url 'blog' %}"
                role="button"
                >–î—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ</a
              >
            </div>
          </div>
        </div>
      </div>

      <!-- –û—Å—Ç–∞–Ω–Ω—ñ —Å—Ç–∞—Ç—Ç—ñ -->
      <h2 class="text-center mb-4">üî• –û—Å—Ç–∞–Ω–Ω—ñ —Å—Ç–∞—Ç—Ç—ñ –ø—Ä–æ –º–µ–º–∏</h2>
      <div class="row">
        {% for article in latest_articles %}
        <div class="col-md-4 mb-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title">{{ article.title }}</h5>
              <p class="card-text">{{ article.content|truncatewords:20 }}</p>
              <p class="text-muted small">{{ article.date|date:"d.m.Y" }}</p>
              <a
                href="{% url 'article_detail' article.pk %}"
                class="btn btn-primary"
                >–ß–∏—Ç–∞—Ç–∏ –¥–∞–ª—ñ</a
              >
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12 text-center">
          <p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î —Å—Ç–∞—Ç–µ–π. –î–æ–¥–∞–π—Ç–µ —ó—Ö —á–µ—Ä–µ–∑ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å!</p>
        </div>
        {% endfor %}
      </div>

      <!-- –ö–∞—Ä—Ç–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É -->
      <h2 class="text-center mb-4 mt-5">üé≠ –ù–∞—à—ñ —Ñ—ñ—à–∫–∏</h2>
      <div class="row">
        <div class="col-md-4 mb-4">
          <div class="card">
            <div class="card-body text-center">
              <h5 class="card-title">üòÇ –°–≤—ñ–∂—ñ –º–µ–º–∏</h5>
              <p class="card-text">
                –©–æ–¥–Ω—è –Ω–æ–≤—ñ —Ç–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ñ –º–µ–º–∏ –∑ —É—Å—å–æ–≥–æ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
              </p>
              <a href="{% url 'blog' %}" class="btn btn-primary">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏</a>
            </div>
          </div>
        </div>
        <div class="col-md-4 mb-4">
          <div class="card">
            <div class="card-body text-center">
              <h5 class="card-title">üìà –¢—Ä–µ–Ω–¥–æ–≤—ñ —Ç–µ–º–∏</h5>
              <p class="card-text">
                –ê–Ω–∞–ª—ñ–∑ –ø–æ–ø—É–ª—è—Ä–Ω–∏—Ö –º–µ–º—ñ–≤ —Ç–∞ —ó—Ö–Ω—å–æ–≥–æ –≤–ø–ª–∏–≤—É –Ω–∞ –∫—É–ª—å—Ç—É—Ä—É.
              </p>
              <a href="{% url 'blog' %}" class="btn btn-primary"
                >–î—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ</a
              >
            </div>
          </div>
        </div>
        <div class="col-md-4 mb-4">
          <div class="card">
            <div class="card-body text-center">
              <h5 class="card-title">üé® –ú–µ–º-–∫—É–ª—å—Ç—É—Ä–∞</h5>
              <p class="card-text">
                –ì–ª–∏–±–æ–∫–∏–π –∑–∞–Ω—É—Ä –≤ —ñ—Å—Ç–æ—Ä—ñ—é —Ç–∞ –µ–≤–æ–ª—é—Ü—ñ—é —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–µ–º—ñ–≤.
              </p>
              <a href="{% url 'about' %}" class="btn btn-primary"
                >–î—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ</a
              >
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="bg-dark text-white text-center py-4 mt-5">
      <div class="container">
        <p>&copy; 2025 MemeLand. –°—Ç–≤–æ—Ä–µ–Ω–æ –∑ ‚ù§Ô∏è –¥–ª—è –ª—é–±–∏—Ç–µ–ª—ñ–≤ –º–µ–º—ñ–≤.</p>
      </div>
    </footer>

    <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è 2FA -->
    {% if show_2fa_setup %}
    <div
      class="modal fade"
      id="setup2FAModal"
      tabindex="-1"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-warning text-dark">
            <h5 class="modal-title">
              <i class="fas fa-shield-alt"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –∞–∫–∞—É–Ω—Ç–∞
            </h5>
          </div>
          <div class="modal-body">
            <div class="alert alert-info">
              <h6><i class="fas fa-info-circle"></i> –í–∞–∂–ª–∏–≤–æ!</h6>
              <p>
                –î–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –≤–∞—à–æ–≥–æ –∞–∫–∞—É–Ω—Ç–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏
                –¥–≤–æ—Ñ–∞–∫—Ç–æ—Ä–Ω—É –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—é (2FA).
              </p>
            </div>

            <div class="text-center">
              <h6>üîê –¶–µ –∑–∞–π–º–µ –ª–∏—à–µ —Ö–≤–∏–ª–∏–Ω—É!</h6>
              <p>
                –î–≤–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –∑–∞—Ö–∏—Å—Ç–∏—Ç—å –≤–∞—à –∞–∫–∞—É–Ω—Ç –≤—ñ–¥
                –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É.
              </p>

              <div class="d-grid gap-2 col-6 mx-auto">
                <a href="{% url 'setup_2fa' %}" class="btn btn-warning btn-lg">
                  <i class="fas fa-shield-alt"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∑–∞—Ä–∞–∑
                </a>
                <button
                  type="button"
                  class="btn btn-outline-secondary"
                  onclick="postpone2FA()"
                >
                  –ü—ñ–∑–Ω—ñ—à–µ
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- –ü–ª–∞–≤–∞—é—á–∏–π —á–∞—Ç-–±–æ—Ç (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤) -->
    {% if user.is_authenticated %}
    <div id="chatWidget" class="chat-widget">
      <div class="chat-toggle-btn" id="chatToggle">
        <i class="fas fa-comments"></i>
        <span class="chat-badge" id="chatBadge" style="display: none">!</span>
      </div>

      <div class="chat-window" id="chatWindow" style="display: none">
        <div class="chat-header">
          <div class="chat-title">
            <i class="fas fa-robot"></i>
            –ü–æ–º—ñ—á–Ω–∏–∫ –ø–æ—à—É–∫—É
          </div>
          <button class="chat-close" id="chatClose">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="chat-messages" id="chatMessages">
          <div class="message bot-message">
            <div class="message-content">
              <div class="bot-avatar">ü§ñ</div>
              <div class="message-bubble">
                –ü—Ä–∏–≤—ñ—Ç! –Ø –¥–æ–ø–æ–º–æ–∂—É –∑–Ω–∞–π—Ç–∏ —Å—Ç–∞—Ç—Ç—ñ —Ç–∞ –Ω–æ–≤–∏–Ω–∏. –©–æ –≤–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å?
              </div>
            </div>
          </div>
        </div>

        <div class="chat-input-area">
          <form id="miniChatForm" class="chat-form">
            <input
              type="text"
              id="miniMessageInput"
              placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –∑–∞–ø–∏—Ç–∞–Ω–Ω—è..."
              autocomplete="off"
            />
            <button type="submit">
              <i class="fas fa-paper-plane"></i>
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- CSS –¥–ª—è —á–∞—Ç-–≤—ñ–¥–∂–µ—Ç—É -->
    <style>
      .chat-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        font-family: Arial, sans-serif;
      }

      .chat-toggle-btn {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
        position: relative;
      }

      .chat-toggle-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
      }

      .chat-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        width: 20px;
        height: 20px;
        background: #ff4757;
        border-radius: 50%;
        color: white;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
      }

      .chat-window {
        position: absolute;
        bottom: 80px;
        right: 0;
        width: 350px;
        height: 450px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        animation: slideUp 0.3s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .chat-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chat-title {
        font-weight: bold;
        font-size: 16px;
      }

      .chat-close {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        transition: background 0.3s;
      }

      .chat-close:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .chat-messages {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
        background: #f8f9fa;
      }

      .message {
        margin-bottom: 15px;
      }

      .message-content {
        display: flex;
        align-items: flex-start;
        gap: 8px;
      }

      .bot-avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: linear-gradient(135deg, #28a745, #20c997);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        flex-shrink: 0;
      }

      .user-avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
        font-weight: bold;
        flex-shrink: 0;
      }

      .message-bubble {
        background: white;
        padding: 10px 15px;
        border-radius: 18px;
        max-width: 250px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        white-space: pre-line;
        font-size: 14px;
        line-height: 1.4;
      }

      .user-message .message-content {
        flex-direction: row-reverse;
      }

      .user-message .message-bubble {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .chat-input-area {
        padding: 15px;
        background: white;
        border-top: 1px solid #eee;
      }

      .chat-form {
        display: flex;
        gap: 10px;
      }

      .chat-form input {
        flex: 1;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 25px;
        outline: none;
        font-size: 14px;
      }

      .chat-form input:focus {
        border-color: #667eea;
      }

      .chat-form button {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
      }

      .chat-form button:hover {
        transform: scale(1.1);
      }

      /* –°—Ç–∏–ª—ñ –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ—à—É–∫—É */
      .search-results {
        max-width: 280px;
      }

      .result-section {
        margin-bottom: 15px;
      }

      .section-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .result-item {
        margin-bottom: 8px;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .result-link {
        display: block;
        padding: 10px 12px;
        background: #f8f9fa;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s;
        border-left: 3px solid transparent;
      }

      .result-link:hover {
        background: #e3f2fd;
        border-left-color: #667eea;
        transform: translateX(2px);
      }

      .result-title {
        font-weight: 500;
        color: #333;
        font-size: 13px;
        line-height: 1.3;
        margin-bottom: 4px;
      }

      .result-meta {
        font-size: 11px;
        color: #666;
      }

      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 0;
      }

      .typing-dots {
        display: flex;
        gap: 4px;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #999;
        animation: typing 1.4s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0%,
        20% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
        80%,
        100% {
          transform: translateY(0);
        }
      }

      /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
      @media (max-width: 480px) {
        .chat-window {
          width: 300px;
          height: 400px;
          bottom: 70px;
          right: -10px;
        }
      }
    </style>
    {% endif %}

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>

    {% if show_2fa_setup %}
    <script>
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª–∫—É –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
      document.addEventListener("DOMContentLoaded", function () {
        var modal = new bootstrap.Modal(
          document.getElementById("setup2FAModal")
        );
        modal.show();
      });

      function postpone2FA() {
        // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –º–æ–¥–∞–ª–∫—É —ñ –ø–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        var modal = bootstrap.Modal.getInstance(
          document.getElementById("setup2FAModal")
        );
        modal.hide();

        // –ü–æ–∫–∞–∑—É—î–º–æ toast –∑ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è–º
        setTimeout(function () {
          var toastHTML = `
                    <div class="toast align-items-center text-white bg-warning border-0" role="alert" 
                         style="position: fixed; top: 20px; right: 20px; z-index: 9999;">
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fas fa-exclamation-triangle"></i> –ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ 2FA –≤ –ø—Ä–æ—Ñ—ñ–ª—ñ!
                            </div>
                            <button type="button" class="btn-close btn-close-white me-2 m-auto" 
                                    data-bs-dismiss="toast"></button>
                        </div>
                    </div>
                `;
          document.body.insertAdjacentHTML("beforeend", toastHTML);
          var toast = new bootstrap.Toast(document.querySelector(".toast"));
          toast.show();
        }, 500);
      }
    </script>
    {% endif %}

    <!-- JavaScript –¥–ª—è —á–∞—Ç-–≤—ñ–¥–∂–µ—Ç—É -->
    {% if user.is_authenticated %}
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const chatToggle = document.getElementById("chatToggle");
        const chatWindow = document.getElementById("chatWindow");
        const chatClose = document.getElementById("chatClose");
        const miniChatForm = document.getElementById("miniChatForm");
        const miniMessageInput = document.getElementById("miniMessageInput");
        const chatMessages = document.getElementById("chatMessages");

        let isOpen = false;

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —á–∞—Ç—É
        chatToggle.addEventListener("click", function () {
          if (isOpen) {
            closeChat();
          } else {
            openChat();
          }
        });

        // –ó–∞–∫—Ä–∏—Ç—Ç—è —á–∞—Ç—É
        chatClose.addEventListener("click", closeChat);

        // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
        miniChatForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          const message = miniMessageInput.value.trim();
          if (!message) return;

          addUserMessage(message);
          miniMessageInput.value = "";
          showTypingIndicator();

          try {
            const response = await fetch("/chatbot/", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": getCookie("csrftoken"),
              },
              body: JSON.stringify({ message: message }),
            });

            const data = await response.json();
            hideTypingIndicator();

            if (data.error) {
              addBotMessage("‚ùå " + data.error);
            } else if (data.results) {
              addBotSearchResults(data.results);
            } else {
              addBotMessage(data.response || "–ü–æ–º–∏–ª–∫–∞ –ø–æ—à—É–∫—É");
            }
          } catch (error) {
            hideTypingIndicator();
            addBotMessage("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è");
          }
        });

        function openChat() {
          chatWindow.style.display = "flex";
          isOpen = true;
          chatToggle.innerHTML = '<i class="fas fa-times"></i>';
          miniMessageInput.focus();
        }

        function closeChat() {
          chatWindow.style.display = "none";
          isOpen = false;
          chatToggle.innerHTML = '<i class="fas fa-comments"></i>';
        }

        function addUserMessage(message) {
          const messageDiv = document.createElement("div");
          messageDiv.className = "message user-message";
          messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="user-avatar">{{ user.username|first|upper }}</div>
                        <div class="message-bubble">${escapeHtml(message)}</div>
                    </div>
                `;
          chatMessages.appendChild(messageDiv);
          scrollToBottom();
        }

        function addBotMessage(response) {
          const messageDiv = document.createElement("div");
          messageDiv.className = "message bot-message";
          messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="bot-avatar">ü§ñ</div>
                        <div class="message-bubble">${escapeHtml(
                          response
                        )}</div>
                    </div>
                `;
          chatMessages.appendChild(messageDiv);
          scrollToBottom();
        }

        function addBotSearchResults(results) {
          const messageDiv = document.createElement("div");
          messageDiv.className = "message bot-message";

          let resultsHTML =
            '<div class="message-content"><div class="bot-avatar">ü§ñ</div><div class="search-results">';

          results.forEach((section) => {
            resultsHTML += `<div class="result-section">`;
            resultsHTML += `<div class="section-title">${section.title}</div>`;

            section.items.forEach((item) => {
              const linkUrl =
                section.type === "articles" ? `/article/${item.id}/` : `/news/`;
              const dateStr = new Date(item.date).toLocaleDateString("uk-UA");
              const authorInfo = item.author ? ` ‚Ä¢ ${item.author}` : "";

              resultsHTML += `
                            <div class="result-item">
                                <a href="${linkUrl}" class="result-link" target="_blank">
                                    <div class="result-title">${escapeHtml(
                                      item.title
                                    )}</div>
                                    <div class="result-meta">${dateStr}${authorInfo}</div>
                                </a>
                            </div>
                        `;
            });

            resultsHTML += "</div>";
          });

          resultsHTML += "</div></div>";
          messageDiv.innerHTML = resultsHTML;

          chatMessages.appendChild(messageDiv);
          scrollToBottom();
        }

        function showTypingIndicator() {
          const typingDiv = document.createElement("div");
          typingDiv.className = "message bot-message typing-indicator";
          typingDiv.id = "typingIndicator";
          typingDiv.innerHTML = `
                    <div class="message-content">
                        <div class="bot-avatar">ü§ñ</div>
                        <div class="typing-dots">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                        </div>
                    </div>
                `;
          chatMessages.appendChild(typingDiv);
          scrollToBottom();
        }

        function hideTypingIndicator() {
          const typingIndicator = document.getElementById("typingIndicator");
          if (typingIndicator) {
            typingIndicator.remove();
          }
        }

        function scrollToBottom() {
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function escapeHtml(text) {
          const div = document.createElement("div");
          div.textContent = text;
          return div.innerHTML;
        }

        function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";");
            for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === name + "=") {
                cookieValue = decodeURIComponent(
                  cookie.substring(name.length + 1)
                );
                break;
              }
            }
          }
          return cookieValue;
        }
      });
    </script>
    {% endif %}
  </body>
</html>
